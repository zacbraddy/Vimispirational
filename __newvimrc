" Initialise ---------------------------------- {{{
  " Kill splash screen
  redraw

  " Startup text
  augroup hello_on_enter
    autocmd!
    autocmd VimEnter * echo "Jacking into the matrix..."
  augroup END
  " turn on filetype detection and syntax highlighting
  filetype plugin indent on
  syntax on

  " Map leader key
  let mapleader = "-"
  let maplocalleader = "="

  " windows prefers noshellslash
  set noshellslash

  " Look for where I normally keep my project directories
  if isdirectory("D:/Projects/") 
    cd D:\Projects
  endif

  if isdirectory("C:/Projects/") 
    cd C:\Projects
  endif

  function! CreateDirectoryIfNotExist(path)
    if !isdirectory(a:path)
      call mkdir(a:path, "p", 700)
    endif
  endfunction

" }}}

" Vim Settings ------------------------------ {{{
  " Turn on line numbers
  set number

  " Turn on relative line number
  set relativenumber

  " Use force two spaces for indent
  set shiftround
  set shiftwidth=2 
  
  " Put all the swap files and other crap in a temp folder
  set backupdir=$VIM/vimfiles/vimtmp/backup//
  set directory=$VIM/vimfiles/vimtmp/swap//
  set undodir=$VIM/vimfiles/vimtmp/undo//
  call CreateDirectoryIfNotExist(&backupdir)
  call CreateDirectoryIfNotExist(&directory)
  call CreateDirectoryIfNotExist(&undodir)

" }}}

" Productivity commands ---------------------- {{{
  " Toggle case on the current word
  inoremap <c-u> <esc>viw~<esc>ea
  nnoremap <c-u> viw~<esc>

  " Surround word with quotes
  nnoremap <leader>" viw<esc>a"<esc>bi"<esc>lel
  nnoremap <leader>' viw<esc>a'<esc>bi'<esc>lel

  " Exit insert/visual mode easier
  inoremap jk <esc>
  vnoremap jk <esc>

  " Comment and uncomment out a line in javascript
  augroup comment_javascript
    autocmd!
    autocmd FileType javascript nnoremap <buffer> <localleader>c I//<esc>
    autocmd FileType javascript nnoremap <buffer> <localleader>u :s/\/\///<cr>
  augroup END

  " Cool parentheses operator pending mappings
  onoremap in( :<c-u>normal! f(vi(<cr>
  onoremap il( :<c-u>normal! F)vi(<cr>
  onoremap an( :<c-u>normal! f(va(<cr>
  onoremap al( :<c-u>normal! F(va(<cr>

  " [E]dit my [V]imrc
  execute "nnoremap <leader>ev :vsplit " . g:pathToVimRc . "<cr>"

  " [S]ource my [V]imrc
  nnoremap <leader>sv :source $MYVIMRC<cr>

  " Move between windows with less keystrokes
  nnoremap <c-h> <c-w>h
  nnoremap <c-j> <c-w>j
  nnoremap <c-k> <c-w>k
  nnoremap <c-l> <c-w>l
  
  " [C]lose [A]ll [B]uffers
    command! CAB silent %bd|echo "All buffers just got blow'd up"

  " Clear highlighting on escape in normal mode
  nnoremap <esc> :noh<return><esc>
  nnoremap <esc>^[ <esc>^[

  " Set and unset shellslash - Particularly important in a windows setup
  " because sometimes plugins prefer noshellslash but other can handle windoze
  nnoremap <F6> :set shellslash<CR>
  nnoremap <F7> :set noshellslash<CR>
  inoremap <F6> :set shellslash<CR>
  inoremap <F7> :set noshellslash<CR>

  " Set tab setting correctly - because at home I prefer two spaces but my
  " work insists on using 4 like animals
  nnoremap <leader>w :set tabstop=8 softtabstop=0 expandtab shiftwidth=4 smarttab <CR> :let g:ale_fixers['javascript'] = ['eslint'] <CR> :let g:ale_fixers['javascript.jsx'] = ['eslint'] <bar> echo "Sorry you're at work fella" <CR>
  nnoremap <leader>h :set tabstop=4 softtabstop=0 expandtab shiftwidth=2 smarttab <bar> echo "You're at home my dude!" <CR>

  " Change pwd to current open buffer path
  nnoremap <leader>cd : cd %:p:h<CR>:pwd<CR>

" }}}

" Javascript settings ------------------------ {{{
  augroup javascript_settings
    autocmd!
    autocmd FileType javascript :setlocal foldmethod=syntax
  augroup END

" }}}

" Abbreviations --------------------- {{{
  " Corrections for common typos
  :iabbrev adn and
  :iabbrev tehn then
  :iabbrev fro for
  :iabbrev teh the
" }}}

" Snippets ----------------------------------- {{{
  " React snippets ----------------------------- {{{
  :iabbrev reactsfc import React from 'react';<cr><cr>const Component = props => {<cr><cr>};<cr><cr>export default Component;<esc>:%s/Component/
  :iabbrev reactcbc import React, { Component } from 'react';<cr><cr>class ClassBasedComponent {<cr><cr>};<cr><cr>export default ClassBasedComponent;<esc>:%s/ClassBasedComponent/
  " }}}
" }}}

" Stop being a noob remaps -------------------- {{{
  " Exit insert mode properly dickhead
  inoremap <esc> <nop>
  vnoremap <esc> <nop>

  " Stop being a noob
  noremap <left> <nop>
  noremap <right> <nop>
  noremap <down> <nop>
  noremap <up> <nop>
  noremap <home> <nop>
  noremap <end> <nop>
  nnoremap <del> <nop>
" }}}

" Vimscript file settings ---------------------- {{{
augroup filetype_vim
  autocmd!
  autocmd FileType vim setlocal foldmethod=marker
  autocmd FileType vim setlocal foldlevelstart=0
augroup END
" }}}
